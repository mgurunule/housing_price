
## Project Overview

Housing price prediction is the process of using statistical and machine learning models to forecast the future prices of residential properties. This project provides a Flask API to perform housing price predictions.

## Table of Contents

- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Usage](#usage)
- [Project Structure](#project-structure)
- [Files](#files)
- [Methods](#methods)

## Prerequisites

List the prerequisites needed to run your project. Include information about the required software, packages, and any other dependencies.

* Python 3.9.13
* pip 
* Virtual environment (optional but recommended)


## Installation
(These steps are for a Windows machine.)

1) Clone the repository to your local machine:                       
    ```git clone https://github.com/mgurunule/housing_price.git```
2) Navigate to the project directory:               
    ``` cd housing_price```                       
3) Create a virtual environment (optional but recommended):                     
   ```python -m venv venv```                         
   or                                    
   Manually create from IDE.
4) Activate the virtual environment.                                    
    * on windows                            
      ```venv\Scripts\activate```               
5) Install project dependencies:                           
  ``` pip install -r requirements.txt ```


**Note:** Don't forget to deactivate the virtual environment when you're done:
```deactivate```


## Usage
1) set path using set PYTHONPATH="complete path" # complete directory untill root
1) run ```python housing_price/database/one_timer.py``` to create tables and databse. This is one time activity usually done by admin.
2) Once the installation is done run the below command to start the API.

   ```python app.py```

3) run test_app.py from the project to see the test runs
    
    Note: Please verify the api url of ```test_app.py``` with the url generated by running ```app.py``` Port number 
      may change sometime. So please pass the port number shown after the ```python app.py```.                    
      If not same please modify the url in ```test_app.py```                                 
              

  ```app.py``` take single record as input and will return predicted value ('MEDIAN_HOUSE_PRICE').

   Note: Please use below column name only in input features.
          There are checks to validate the columns name in the program.

Valid columns names :  
 * longitude 
 * latitude
 * housing_median_age
 * total_rooms
 * total_bedrooms
 * population
 * households
 * median_income
 * ocean_proximity

These names were taken from feature_names_in attribute of  
RandomForest model. If we do not need the valid column 
name check then we can comment the code in comment 
```is_invalid_column_names()``` call in 
validation_transformation.py.

Sample input record:
```
longitude: -122.64
latitude: 38.01
housing_median_age: 36.0
total_rooms: 1336.0
total_bedrooms: 258.0
population: 678.0
households: 249.0
median_income: 5.5789
ocean_proximity: 'NEAR OCEAN'
```

Output : `320201.58554044`

The sample input should be converted into dictionary and should be passed to 
```request.post()``` call (Please check test_app.py for example)
```
 { 'longitude': -122.64, 
 'latitude': 38.01, 
 'housing_median_age': 36.0,
 'total_rooms': '1336.0', 
 'total_bedrooms': 258.0, 
 'population': 678.0,
  'households': 249.0, 
  'median_income': 5.5789, 
  'ocean_proximity': 'NEAR OCEAN'}
  ```

API will return response object.
1) On success, ```response.status_code``` will be 200 
   and to get predicted value use ```response.json()['MEDIAN_HOUSE_PRICE'])```
2) On Failure,```response.status_code``` will be 999 
   and ```response.json()['error message']``` to get ERROR MESSAGE.


   ```test_app.py``` have some positive and negative test cases.


4) To run all th test case. run ```pytest -v``` from root directory.


### Project Structure

Describe the structure of your project, including key directories and files.
```
housing_price/                           
│      
├── housing_price/                       
│   ├── constants/                  
│   ├── databse/           
│   ├── pipeline/           
│   ├── trained_model/         
│   ├── training_data/   
│   └── logger.py                    
├── tests/ 
├── logs/                                       
├── app.py                                      
├── predict_from_model.py                                              
├── requirements.txt                                        
├── schema_prediction.json   
├── test_app.py
└── validation_transformation.py                                     
```

## Files
* `app.py` - Flask script which will open the endpoint. User will pass input data to this end point.
* `predict_from_model.py` -  This script will load the model, perform prediction and save the data in DB.  
* `requirements.txt` - pip dependencies
* `schema_prediction.json` - schema of input data.
* `validation_transformation.py` - This Script will perform validation and transformation of input data
* `test_app.py` - script to test the execution of api
* `housing_price/constants/` - constants for the project
* `housing_price/databse/`  - database related query file, operations file and DB storage.
* `housing_price/pipeline/` - Script to perform data validation and data transformation.
* `housing_price/trained_model/model.joblib` - the computed model you should use 
* `housing_price/training_data/housing.csv` - data file to process and apply a model to it for creating predictions
* `housing_price/logger.py` - main logger script.
* `logs/` - log file of each run.
* `tests/` - pytest cases.


## Methods

### 1) Data Validation
Script location : ```housing_price/pipeline/data_validation.py```

    Basic validations were performed for this project.
    - Verified the number of columns
    - Verified the name of the columns
    - Verified the type of the columns
    - checked for null column

  We are converting type of below columns to float as this 
  was done with training data.
* housing_median_age
* total_rooms
* total_bedrooms
* population
* households
* median_income

So API will accept values for these columns in both string and numerical format.
But later it will convert to numerical vakue.

If data fails any of the validation step then, further processing will be skipped
recording the error message in log.

### 2) Data Transformation
Script location : ```housing_price/pipeline/data_transformation.py```

    Basic transformations were performed for this project.
    - Dropping the rows having null
    - Encoding of categorical columns
    - Add Missing column 

### 3) Prediction
    - loading the model
    - perform prediction

### 4) DataBase Operations 

    
      For this project Sqlite3 database has been used and 2 tables are created.
      1) predicted_data_table : table to save predicted output.
      2) transformed_data_table : table to save transformed output.
      
      (structure of tables and db queries are present in below location) 
          -> "housing_price/databse/query/"

      Currently below opearation are possible.
        - DB connection      : create connection with db
        - inserting in table (db_operations.py)       : insert record into table
        - fetch data from db (fetching_from_table.py) : This will fetch complete data from DB. 
      Note : future ehancement will be fetching data from DB based 
             on conditions.




## Contact

    Name : Manish Gurunule
    Mail : 

    Please let me know you feedback. Thanks you.


## Queries.

1) OCEAN_PROXIMITY feature has 6 valid values
   (NEAR BAY,OUT OF REACH, <1H OCEAN, INLAND, NEAR OCEAN, ISLAND) out of which "OUT OF REACH" is 
   not used during model creation. What if this parameter is passed as input. Should we through 
   error or just filter is out and continue for prediction.
   ( Currently I will continue for prediction and will error out
     only any other value is passed except these 6)
